# 订单管理数据库使用说明

## 概述

系统已搭建订单管理数据库环境，所有订单数据现在存储在 SQLite 数据库中，并通过 REST API 提供数据访问。

## 数据库环境

- **数据库类型**: SQLite
- **数据库文件**: `server/data/orders.db`
- **后端服务器**: Node.js + Express
- **API 地址**: http://localhost:3000

## 快速开始

### 1. 安装后端依赖

```bash
cd server
npm install
```

### 2. 初始化数据库

```bash
npm run init-db
```

这将：
- 创建数据库文件 `data/orders.db`
- 创建 `bills_of_lading` 表
- 导入初始数据

### 3. 启动后端服务器

开发模式（自动重启）：
```bash
npm run dev
```

生产模式：
```bash
npm start
```

### 4. 启动前端（从项目根目录）

```bash
npm run dev
```

或者同时启动前后端：
```bash
npm run dev:all
```

## API 接口

### 获取提单列表
```
GET /api/bills?page=1&pageSize=10&type=schedule&search=关键词
```

参数：
- `page`: 页码（默认 1）
- `pageSize`: 每页数量（默认 10）
- `type`: 类型（'schedule' 进行中 / 'draft' 已完结）
- `search`: 搜索关键词
- `status`: 状态过滤

### 获取提单详情
```
GET /api/bills/:id
```

### 创建提单
```
POST /api/bills
Content-Type: application/json

{
  "billNumber": "EGLV010501130029",
  "containerNumber": "EGHU9400490",
  ...
}
```

### 更新提单
```
PUT /api/bills/:id
Content-Type: application/json

{
  "status": "已到港",
  ...
}
```

### 删除提单
```
DELETE /api/bills/:id
```

## 数据库结构

### bills_of_lading 表

| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | TEXT | 主键 |
| bill_id | TEXT | 提单ID（用于草稿页面） |
| bill_number | TEXT | 提单号 |
| container_number | TEXT | 集装箱编号 |
| vessel | TEXT | 船名航次 |
| eta | TEXT | 预计到港时间 |
| ata | TEXT | 实际到港时间 |
| pieces | INTEGER | 件数 |
| weight | REAL | 毛重(KGS) |
| volume | REAL | 体积(CBM) |
| inspection | TEXT | 查验状态 |
| customs_stats | TEXT | 报关统计 |
| creator | TEXT | 创建者 |
| create_time | TEXT | 创建时间 |
| status | TEXT | 状态（已到港/船未到港/已完成/已归档/已取消） |
| shipper | TEXT | 发货人 |
| consignee | TEXT | 收货人 |
| notify_party | TEXT | 通知方 |
| port_of_loading | TEXT | 装货港 |
| port_of_discharge | TEXT | 卸货港 |
| place_of_delivery | TEXT | 交货地 |
| complete_time | TEXT | 完成时间 |
| delivery_status | TEXT | 派送状态 |
| transport_method | TEXT | 运输方式 |
| company_name | TEXT | 公司名 |
| created_at | DATETIME | 数据库创建时间 |
| updated_at | DATETIME | 数据库更新时间 |

## 前端集成

前端代码已更新，会自动从 API 获取数据。如果 API 服务器未启动，前端会显示空列表。

### 环境变量

在项目根目录创建 `.env` 文件：
```
VITE_API_BASE_URL=http://localhost:3000
```

## 数据迁移

现有的 mock 数据已通过 `init-db.js` 脚本导入到数据库中。后续所有数据操作都会保存到数据库。

## 注意事项

1. 数据库文件 `server/data/orders.db` 已添加到 `.gitignore`，不会被提交到版本控制
2. 生产环境建议使用 PostgreSQL 或 MySQL 替代 SQLite
3. 数据库备份：定期备份 `server/data/orders.db` 文件

