# è®¢å•è¯¦æƒ…é¡µé™„åŠ å±æ€§å­—æ®µæ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2024-12-XX

## æ£€æŸ¥ç»“æœ

### âŒ é—®é¢˜å‘ç°

**å›¾ç‰‡ä¸­æ˜¾ç¤ºçš„"é™„åŠ å±æ€§"å­—æ®µåœ¨è®¢å•è¯¦æƒ…é¡µä¸­æœªæ˜¾ç¤º**

### é—®é¢˜åˆ†æ

#### 1. åˆ›å»ºè¡¨å•ä¸­å­˜åœ¨ âœ…
- `src/components/CreateBillModal.tsx` ä¸­æœ‰å®Œæ•´çš„é™„åŠ å±æ€§è¡¨å•å­—æ®µï¼ˆ2335-2590è¡Œï¼‰
- åŒ…æ‹¬ï¼šç®±å‹ã€æå•ç±»å‹ã€è¿è¾“ã€æ”¶è´§äººã€å¼‚åœ°è¿˜æŸœã€å…¨ç¨‹æ•´æŸœè¿è¾“ã€æœ«ç«¯è¿è¾“æ–¹å¼ã€æ‹†æŸœã€T1æŠ¥å…³

#### 2. æäº¤æ—¶æœªåŒ…å« âŒ
- `CreateBillModal.tsx` çš„ `handleSubmit` å‡½æ•°ï¼ˆ937è¡Œï¼‰æ„å»º `billData` æ—¶**æ²¡æœ‰åŒ…å«è¿™äº›é™„åŠ å±æ€§å­—æ®µ**
- æäº¤çš„æ•°æ®ä¸­ç¼ºå°‘ï¼š
  - `containerType` (ç®±å‹)
  - `billType` (æå•ç±»å‹)
  - `transportArrangement` (è¿è¾“)
  - `consigneeType` (æ”¶è´§äºº)
  - `containerReturn` (å¼‚åœ°è¿˜æŸœ)
  - `fullContainerTransport` (å…¨ç¨‹æ•´æŸœè¿è¾“)
  - `lastMileTransport` (æœ«ç«¯è¿è¾“æ–¹å¼)
  - `devanning` (æ‹†æŸœ)
  - `t1Declaration` (T1æŠ¥å…³)

#### 3. æ•°æ®åº“è¡¨ç¼ºå°‘å­—æ®µ âŒ
- `bills_of_lading` è¡¨ä¸­æ²¡æœ‰è¿™äº›å­—æ®µ
- éœ€è¦æ·»åŠ ä»¥ä¸‹å­—æ®µï¼š
  - `container_type` TEXT (ç®±å‹: cfs/fcl)
  - `bill_type` TEXT (æå•ç±»å‹: master/house)
  - `transport_arrangement` TEXT (è¿è¾“: entrust/self)
  - `consignee_type` TEXT (æ”¶è´§äºº: asl/not-asl)
  - `container_return` TEXT (å¼‚åœ°è¿˜æŸœ: off-site/local)
  - `full_container_transport` TEXT (å…¨ç¨‹æ•´æŸœè¿è¾“: must-full/can-split)
  - `last_mile_transport` TEXT (æœ«ç«¯è¿è¾“æ–¹å¼: truck/train/air)
  - `devanning` TEXT (æ‹†æŸœ: required/not-required)
  - `t1_declaration` TEXT (T1æŠ¥å…³: yes/no)

#### 4. APIæœªæ¥æ”¶å’Œä¿å­˜ âŒ
- `server/index.js:3421` åˆ›å»ºæå•APIæ²¡æœ‰æ¥æ”¶è¿™äº›å­—æ®µ
- `server/index.js:3455` INSERTè¯­å¥ä¸­æ²¡æœ‰åŒ…å«è¿™äº›å­—æ®µ

#### 5. è¯¦æƒ…é¡µæœªæ˜¾ç¤º âŒ
- `src/pages/BillDetails.tsx` è¯¦æƒ…é¡µä¸­æ²¡æœ‰"é™„åŠ å±æ€§"éƒ¨åˆ†
- åªæ˜¾ç¤ºäº†ï¼šæå•ä¿¡æ¯ã€æ”¶å‘è´§ä¿¡æ¯ã€çŠ¶æ€ä¿¡æ¯ç­‰

---

## éœ€è¦ä¿®å¤çš„å†…å®¹

### 1. æ•°æ®åº“è¡¨ç»“æ„
æ·»åŠ å­—æ®µåˆ° `bills_of_lading` è¡¨

### 2. åˆ›å»ºæå•API
- æ¥æ”¶è¿™äº›é™„åŠ å±æ€§å­—æ®µ
- ä¿å­˜åˆ°æ•°æ®åº“

### 3. åˆ›å»ºæå•å‰ç«¯
- åœ¨æäº¤æ•°æ®ä¸­åŒ…å«è¿™äº›å­—æ®µ

### 4. è®¢å•è¯¦æƒ…é¡µ
- æ·»åŠ "é™„åŠ å±æ€§"æ˜¾ç¤ºéƒ¨åˆ†
- æ˜¾ç¤ºæ‰€æœ‰é™„åŠ å±æ€§å­—æ®µçš„å€¼

### 5. TypeScriptç±»å‹å®šä¹‰
- åœ¨ `BillOfLading` æ¥å£ä¸­æ·»åŠ è¿™äº›å­—æ®µ

---

## ä¿®å¤ä¼˜å…ˆçº§

**é«˜ä¼˜å…ˆçº§** - è¿™äº›å­—æ®µæ˜¯ä¸šåŠ¡å…³é”®ä¿¡æ¯ï¼Œéœ€è¦å®Œæ•´ä¿å­˜å’Œæ˜¾ç¤º

---

## âœ… ä¿®å¤å®Œæˆ

### ä¿®å¤å†…å®¹

#### 1. æ•°æ®åº“è¡¨ç»“æ„ âœ…
- âœ… åœ¨ `server/index.js` ä¸­æ·»åŠ äº†9ä¸ªé™„åŠ å±æ€§å­—æ®µçš„ALTER TABLEè¯­å¥
- âœ… åœ¨ `server/scripts/pg-init-schema.sql` ä¸­æ·»åŠ äº†å­—æ®µå®šä¹‰

**æ·»åŠ çš„å­—æ®µ**:
- `container_type` TEXT (ç®±å‹)
- `bill_type` TEXT (æå•ç±»å‹)
- `transport_arrangement` TEXT (è¿è¾“)
- `consignee_type` TEXT (æ”¶è´§äºº)
- `container_return` TEXT (å¼‚åœ°è¿˜æŸœ)
- `full_container_transport` TEXT (å…¨ç¨‹æ•´æŸœè¿è¾“)
- `last_mile_transport` TEXT (æœ«ç«¯è¿è¾“æ–¹å¼)
- `devanning` TEXT (æ‹†æŸœ)
- `t1_declaration` TEXT (T1æŠ¥å…³)

#### 2. åˆ›å»ºæå•API âœ…
- âœ… `server/index.js:3421` - æ¥æ”¶é™„åŠ å±æ€§å­—æ®µ
- âœ… `server/index.js:3455` - INSERTè¯­å¥ä¸­åŒ…å«è¿™äº›å­—æ®µ
- âœ… `server/index.js:2855` - `convertToCamelCase`å‡½æ•°ä¸­æ·»åŠ å­—æ®µè½¬æ¢

#### 3. æ›´æ–°æå•API âœ…
- âœ… `server/index.js:3606` - æ›´æ–°APIè¿”å›æ•°æ®ä½¿ç”¨convertToCamelCaseè½¬æ¢

#### 4. åˆ›å»ºæå•å‰ç«¯ âœ…
- âœ… `src/components/CreateBillModal.tsx:937` - æäº¤æ—¶åŒ…å«é™„åŠ å±æ€§å­—æ®µ
- âœ… `src/components/CreateBillModal.tsx:1057` - ä¿å­˜è‰ç¨¿æ—¶ä¹ŸåŒ…å«è¿™äº›å­—æ®µ

#### 5. TypeScriptç±»å‹å®šä¹‰ âœ…
- âœ… `src/utils/api/types.ts:91` - `BillOfLading`æ¥å£ä¸­æ·»åŠ äº†9ä¸ªé™„åŠ å±æ€§å­—æ®µ

#### 6. è®¢å•è¯¦æƒ…é¡µæ˜¾ç¤º âœ…
- âœ… `src/pages/BillDetails.tsx:749` - æ·»åŠ äº†"é™„åŠ å±æ€§"æ˜¾ç¤ºéƒ¨åˆ†
- âœ… æ˜¾ç¤ºæ‰€æœ‰9ä¸ªé™„åŠ å±æ€§å­—æ®µï¼Œå¹¶æ­£ç¡®è½¬æ¢æ˜¾ç¤ºæ–‡æœ¬

### å­—æ®µæ˜ å°„è¡¨

| æ•°æ®åº“å­—æ®µ | å‰ç«¯å­—æ®µ | æ˜¾ç¤ºæ–‡æœ¬æ˜ å°„ |
|-----------|---------|-------------|
| container_type | containerType | cfsâ†’æ‹¼ç®±(CFS), fclâ†’æ•´ç®±(FCL) |
| bill_type | billType | masterâ†’èˆ¹ä¸œå•(Master Bill), houseâ†’è´§ä»£å•(House Bill) |
| transport_arrangement | transportArrangement | entrustâ†’å§”æ‰˜æˆ‘å¸è¿è¾“, selfâ†’è‡ªè¡Œè¿è¾“ |
| consignee_type | consigneeType | aslâ†’ASLä¸ºæ”¶è´§äºº, not-aslâ†’ASLä¸æ˜¯æå•æ”¶è´§äºº |
| container_return | containerReturn | off-siteâ†’å¼‚åœ°è¿˜æŸœ(éRotterdam), localâ†’æœ¬åœ°è¿˜æŸœ |
| full_container_transport | fullContainerTransport | must-fullâ†’å¿…é¡»æ•´æŸœæ´¾é€, can-splitâ†’å¯æ‹†æŸœåæ‰˜ç›˜é€è´§ |
| last_mile_transport | lastMileTransport | truckâ†’å¡è½¦æ´¾é€, trainâ†’é“è·¯è¿è¾“, airâ†’ç©ºè¿ |
| devanning | devanning | requiredâ†’éœ€è¦æ‹†æŸœåˆ†è´§æœåŠ¡, not-requiredâ†’ä¸éœ€è¦æ‹†æŸœ |
| t1_declaration | t1Declaration | yesâ†’æ˜¯, noâ†’å¦ |

### ä¿®å¤æ•ˆæœ

âœ… **åˆ›å»ºæå•æ—¶**: é™„åŠ å±æ€§å­—æ®µä¼šè¢«æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“
âœ… **è®¢å•è¯¦æƒ…é¡µ**: é™„åŠ å±æ€§å­—æ®µä¼šæ­£ç¡®æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰å€¼ï¼‰
âœ… **æ•°æ®ä¸€è‡´æ€§**: å‰åç«¯å­—æ®µåç§°ç»Ÿä¸€ï¼Œç±»å‹å®šä¹‰å®Œæ•´

### æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: å¯¹äºå·²å­˜åœ¨çš„è®¢å•ï¼Œè¿™äº›å­—æ®µå¯èƒ½ä¸ºNULLï¼Œè¯¦æƒ…é¡µä¼šæ™ºèƒ½åˆ¤æ–­ï¼Œåªåœ¨æœ‰å€¼æ—¶æ‰æ˜¾ç¤º"é™„åŠ å±æ€§"éƒ¨åˆ†
2. **æ•°æ®åº“è¿ç§»**: è¿è¡Œä»£ç åï¼Œæ•°æ®åº“ä¼šè‡ªåŠ¨æ·»åŠ è¿™äº›å­—æ®µï¼ˆé€šè¿‡ALTER TABLEï¼‰
3. **å­—æ®µéªŒè¯**: åˆ›å»ºæå•æ—¶ï¼Œè¿™äº›å­—æ®µåœ¨è¡¨å•ä¸­æ˜¯å¿…å¡«é¡¹ï¼ˆå¸¦*å·ï¼‰ï¼Œä½†ä¿å­˜è‰ç¨¿æ—¶å¯ä»¥ä¸ºç©º

---

## ğŸ‰ ä¿®å¤å®Œæˆæ—¶é—´
2024-12-XX

æ‰€æœ‰é—®é¢˜å·²ä¿®å¤å®Œæˆï¼
